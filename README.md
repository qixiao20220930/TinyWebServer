# TinyWebServer

Linux下C++轻量级Web服务器，助力初学者快速实践网络编程，搭建属于自己的服务器.

- 使用 **线程池 + 非阻塞socket + epoll(ET和LT均实现) + 事件处理(Reactor和模拟Proactor均实现)** 的并发模型
- 使用**状态机**解析HTTP请求报文，支持解析**GET和POST**请求
- 访问服务器数据库实现web端用户**注册、登录**功能，可以请求服务器**图片和视频文件**
- 实现**同步/异步日志系统**，记录服务器运行状态
- 经Webbench压力测试可以实现**上万的并发连接**数据交换



## 概述

> - 线程同步机制包装类
>
>   ​		多线程同步，确保任一时刻只能有一个线程能进入关键代码段.
>
>   > * 信号量
>   > * 互斥锁
>   > * 条件变量
>
> - http连接请求处理类
>
>   ​		根据状态转移,通过主从状态机封装了http连接类。其中,主状态机在内部调用从状态机,从状态机将		处理状态和数据传给主状态机
>
>   > * 客户端发出http连接请求
>   > * 从状态机读取数据,更新自身状态和接收数据,传给主状态机
>   > * 主状态机根据从状态机状态,更新自身状态,决定响应请求还是继续读取
>
> - 半同步/半反应堆线程池
>
>   ​		使用一个工作队列完全解除了主线程和工作线程的耦合关系：主线程往工作队列中插入任务，工		作线程通过竞争来取得任务并执行它。
>
>   > * 同步I/O模拟proactor模式
>   > * 半同步/半反应堆
>   > * 线程池
>
> - 定时器处理非活动连接
>
>   ​		由于非活跃连接占用了连接资源，严重影响服务器的性能，通过实现一个服务器定时器，处理这种		非活跃连接，释放连接资源。利用alarm函数周期性地触发SIGALRM信号,该信号的信号处理函数利		用管道通知主循环执行定时器链表上的定时任务.
>   > * 统一事件源
>   > * 基于升序链表的定时器
>   > * 处理非活动连接
>
> - 同步/异步日志系统
>
>   ​		同步/异步日志系统主要涉及了两个模块，一个是日志模块，一个是阻塞队列模块,其中加入阻塞队列		模块主要是解决异步写入日志做准备.
>   > * 自定义阻塞队列
>   > * 单例模式创建日志
>   > * 同步日志
>   > * 异步日志
>   > * 实现按天、超行分类
>
> - 数据库连接池
>
>   ​		数据库连接池
>
>   > * 单例模式，保证唯一
>   > * list实现连接池
>   > * 连接池为静态大小
>   > * 互斥锁实现线程安全
>
>   ​		CGI  
>   > * HTTP请求采用POST方式
>   > * 登录用户名和密码校验
>   > * 用户注册及多线程注册安全
>
> - 简易服务器压力测试
>
>   ​		Webbench是有名的网站压力测试工具，它是由[Lionbridge](http://www.lionbridge.com)公司开发。
>
>   > * 测试处在相同硬件上，不同服务的性能以及不同硬件上同一个服务的运行状况。
>   > * 展示服务器的两项内容：每秒钟响应请求数和每秒钟传输数据量。

## 框架

[![img](https://camo.githubusercontent.com/8813be3bb9590eba2207d27b95404ec996891960b47ebb3a447b6c943c0b714d/687474703a2f2f7777312e73696e61696d672e636e2f6c617267652f303035544a3263376c79316765306a3161747135686a33306736306c6d3077342e6a7067)](https://camo.githubusercontent.com/8813be3bb9590eba2207d27b95404ec996891960b47ebb3a447b6c943c0b714d/687474703a2f2f7777312e73696e61696d672e636e2f6c617267652f303035544a3263376c79316765306a3161747135686a33306736306c6d3077342e6a7067)



## 压力测试

在关闭日志后，使用Webbench对服务器进行压力测试，对listenfd和connfd分别采用ET和LT模式，均可实现上万的并发连接。





参考及转载：

https://github.com/qinguoyi/TinyWebServer

[Tinywebserver——服务器常问面试题！ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/368154495)

[web服务器项目部分问题汇总 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/269247362)